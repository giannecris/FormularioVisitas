<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Formulário VTal</title>

<style>
:root {
    --primary: #000;
    --border: #d7d7d7;
    --radius: 10px;
    --shadow: 0 3px 10px rgba(0,0,0,0.05);
}

body {
    font-family: Inter, Arial, sans-serif;
    background: #f5f6f8;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 440px;
    margin: 20px auto;
    padding: 18px;
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
}

.logo {
    width: 150px;
    display: block;
    margin: 0 auto 18px;
}

h2 {
    text-align: center;
    font-size: 20px;
    margin-bottom: 22px;
}

label {
    font-weight: 600;
    margin-top: 14px;
    display: block;
    font-size: 14px;
}

input, select, textarea {
    width: 100%;
    padding: 12px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    margin-top: 5px;
    font-size: 14px;
    background: #fafafa;
    box-sizing: border-box;
}

textarea { height: 110px; }

.row-two {
    display: flex;
    gap: 10px;
}

.field { flex: 1; }

.chips-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}

.chip {
    background: #efefef;
    border: 1px solid #ccc;
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 13px;
}

.chip span {
    margin-left: 8px;
    cursor: pointer;
    font-weight: bold;
}

.autocomplete-list {
    border: 1px solid var(--border);
    border-top: none;
    max-height: 200px;
    overflow-y: auto;
    background: white;
    position: absolute;
    width: calc(100% - 36px);
    z-index: 10;
    box-shadow: var(--shadow);
}

.autocomplete-item {
    padding: 10px;
    cursor: pointer;
}

.autocomplete-item:hover {
    background: #f0f0f0;
}

button {
    width: 100%;
    margin-top: 22px;
    padding: 14px;
    background: var(--primary);
    color: white;
    font-size: 16px;
    border: none;
    border-radius: var(--radius);
    cursor: pointer;
}

.add-btn {
    margin-top: 10px;
    padding: 10px;
    font-size: 14px;
}
</style>
</head>

<body>
<div class="container">

<img src="vtal_logo.png" class="logo">
<h2>Formulário de Visita</h2>

<form id="vtalForm">

<div class="row-two">
    <div class="field">
        <label>Operadora</label>
        <select id="operadora" required>
            <option value="">Selecione</option>
            <option>Claro</option>
            <option>TIM</option>
            <option>Vivo</option>
        </select>
    </div>

    <div class="field">
        <label>Data</label>
        <input type="date" id="data_visita" required>
    </div>
</div>

<label>Com quem é a reunião?</label>
<div class="row-two">
    <div class="field">
        <input id="nomeReuniao" placeholder="Nome">
    </div>
    <div class="field">
        <input id="cargoReuniao" placeholder="Cargo">
    </div>
</div>

<button type="button" id="addReuniaoBtn" class="add-btn">+ Adicionar pessoa</button>
<div class="chips-container" id="reuniaoChips"></div>

<label>Tipo de Visita</label>
<select id="tipo_visita" required>
    <option value="">Selecione</option>
    <option>Administrativa</option>
    <option>Negócios</option>
    <option>Relacionamento</option>
</select>

<label>Produto</label>
<select id="produto" required>
    <option value="">Selecione</option>
    <option>DAS</option>
    <option>SLS</option>
    <option>ENERGIA</option>
    <option>OUTROS</option>
</select>

<label>Venues</label>
<input id="venueInput" placeholder="Digite para buscar">
<div id="autocompleteList" class="autocomplete-list" style="display:none;"></div>
<div class="chips-container" id="chipsContainer"></div>

<div id="outraVenueContainer" style="display:none;">
    <label>Outra venue</label>
    <input id="outraVenue" placeholder="Digite a venue">
</div>

<label>Observações</label>
<textarea id="observacoes"></textarea>

<button type="submit">Enviar</button>
</form>
</div>

<script>
/* ===== REUNIÕES ===== */
let reunioes = [];

document.getElementById("addReuniaoBtn").onclick = () => {
    const nome = nomeReuniao.value.trim();
    const cargo = cargoReuniao.value.trim();
    if (!nome || !cargo) return;

    reunioes.push({ nome, cargo });
    nomeReuniao.value = "";
    cargoReuniao.value = "";
    renderReunioes();
};

function renderReunioes() {
    reuniaoChips.innerHTML = "";
    reunioes.forEach((r, i) => {
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.innerHTML = `${r.nome} (${r.cargo}) <span>×</span>`;
        chip.querySelector("span").onclick = () => {
            reunioes.splice(i, 1);
            renderReunioes();
        };
        reuniaoChips.appendChild(chip);
    });
}

/* ===== VENUES ===== */
const venues = ["Todas","Outra","AEME SHOPPING","MIDWAY MALL","SHOPPING DA ILHA","BEYOND THE CLUB"];
let selectedVenues = [];

venueInput.oninput = () => {
    const val = venueInput.value.toLowerCase();
    autocompleteList.innerHTML = "";
    autocompleteList.style.display = "none";
    if (!val) return;

    venues.filter(v => v.toLowerCase().includes(val) && !selectedVenues.includes(v))
        .forEach(v => {
            const div = document.createElement("div");
            div.className = "autocomplete-item";
            div.textContent = v;
            div.onclick = () => {
                addVenue(v);
                venueInput.value = "";
                autocompleteList.style.display = "none";
            };
            autocompleteList.appendChild(div);
            autocompleteList.style.display = "block";
        });
};

function addVenue(v) {
    if (v === "Todas") selectedVenues = [];
    if (v === "Outra") outraVenueContainer.style.display = "block";
    selectedVenues.push(v);
    renderVenues();
}

function renderVenues() {
    chipsContainer.innerHTML = "";
    selectedVenues.forEach((v, i) => {
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.innerHTML = `${v} <span>×</span>`;
        chip.querySelector("span").onclick = () => {
            selectedVenues.splice(i, 1);
            if (v === "Outra") {
                outraVenueContainer.style.display = "none";
                outraVenue.value = "";
            }
            renderVenues();
        };
        chipsContainer.appendChild(chip);
    });
}

/* ===== SUBMIT ===== */
vtalForm.onsubmit = async e => {
    e.preventDefault();

    if (!reunioes.length) return alert("Adicione alguém na reunião.");
    if (!selectedVenues.length) return alert("Selecione ao menos uma venue.");
    if (selectedVenues.includes("Outra") && !outraVenue.value.trim())
        return alert("Preencha a outra venue.");

    const payload = {
        operadora: operadora.value,
        data_visita: data_visita.value,
        reunioes: reunioes.map(r => `${r.nome} (${r.cargo})`).join("; "),
        tipo_visita: tipo_visita.value,
        produto: produto.value,
        venues: selectedVenues.includes("Outra")
            ? selectedVenues.filter(v => v !== "Outra").concat(outraVenue.value).join("; ")
            : selectedVenues.join("; "),
        observacoes: observacoes.value
    };

    await fetch("SUA_URL_DO_APPS_SCRIPT", {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    alert("Formulário enviado com sucesso!");
    location.reload();
};
</script>

</body>
</html>

